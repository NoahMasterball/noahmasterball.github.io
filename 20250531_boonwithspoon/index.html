<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BWS Game</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/ui.css">
    <link rel="stylesheet" href="assets/css/levels.css">
</head>
<body>
    <!-- Game Container -->
    <div id="gameContainer">
        <!-- Debug info (hidden in production) -->
        <div id="debugInfo" style="display: none; position: fixed; top: 10px; right: 10px; background: rgba(255,0,0,0.8); color: white; padding: 10px; z-index: 9999; font-family: monospace; font-size: 12px;">
            Debug Info
        </div>
    </div>

    <!-- Simplified approach - only load essential classes -->
    <script src="src/utils/EventManager.js"></script>
    <script src="src/ui/Menu.js"></script>
    
    <!-- Main Game Script -->
    <script>
        console.log('BWS Game loading...');
        
        // Simple game state management
        let gameState = 'menu'; // 'menu', 'playing', 'credits'
        let currentScreen = null;
        let player = null;
        let obstacles = [];
        let gameLoop = null;
        
        // Player object
        class SimplePlayer {
            constructor() {
                this.x = 100;
                this.y = 350;
                this.width = 40;
                this.height = 60;
                this.velocityX = 0;
                this.velocityY = 0;
                this.speed = 200;
                this.jumpPower = 300;
                this.gravity = 600;
                this.isOnGround = true;
                this.isDucking = false;
                this.groundY = 350;
                this.element = null;
                this.keys = { left: false, right: false, up: false, down: false };
                
                this.createElement();
                this.setupControls();
            }
            
            createElement() {
                this.element = document.createElement('div');
                this.element.className = 'game-player';
                this.element.style.position = 'absolute';
                this.element.style.width = this.width + 'px';
                this.element.style.height = this.height + 'px';
                this.element.style.zIndex = '10';
                this.element.style.transition = 'height 0.1s ease';
                
                // Player design like in screenshot
                this.element.innerHTML = `
                    <div style="width: 100%; height: 30%; background: #ffdbac; border-radius: 50%; position: relative; border: 2px solid #333;">
                        <div style="position: absolute; top: 8px; left: 8px; width: 4px; height: 4px; background: #000; border-radius: 50%;"></div>
                        <div style="position: absolute; top: 8px; right: 8px; width: 4px; height: 4px; background: #000; border-radius: 50%;"></div>
                        <div style="position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); width: 12px; height: 2px; background: #333; border-radius: 2px;"></div>
                    </div>
                    <div style="width: 100%; height: 70%; background: #2c5aa0; border: 2px solid #1a4480; margin-top: -2px; position: relative;">
                        <div style="position: absolute; top: 10%; left: -20%; width: 40%; height: 8px; background: #2c5aa0; border: 2px solid #1a4480;"></div>
                        <div style="position: absolute; top: 10%; right: -20%; width: 40%; height: 8px; background: #2c5aa0; border: 2px solid #1a4480;"></div>
                        <div style="position: absolute; bottom: 0; left: 20%; width: 20%; height: 40%; background: #2c5aa0; border: 2px solid #1a4480;"></div>
                        <div style="position: absolute; bottom: 0; right: 20%; width: 20%; height: 40%; background: #2c5aa0; border: 2px solid #1a4480;"></div>
                    </div>
                `;
                
                document.getElementById('gameContainer').appendChild(this.element);
                this.updatePosition();
            }
            
            setupControls() {
                document.addEventListener('keydown', (e) => {
                    if (gameState !== 'playing') return;
                    
                    switch(e.code) {
                        case 'KeyW':
                        case 'ArrowUp':
                            if (this.isOnGround && !this.isDucking) {
                                this.velocityY = -this.jumpPower;
                                this.isOnGround = false;
                            }
                            break;
                        case 'KeyS':
                        case 'ArrowDown':
                            this.keys.down = true;
                            this.duck(true);
                            break;
                        case 'KeyA':
                        case 'ArrowLeft':
                            this.keys.left = true;
                            break;
                        case 'KeyD':
                        case 'ArrowRight':
                            this.keys.right = true;
                            break;
                    }
                });
                
                document.addEventListener('keyup', (e) => {
                    switch(e.code) {
                        case 'KeyS':
                        case 'ArrowDown':
                            this.keys.down = false;
                            this.duck(false);
                            break;
                        case 'KeyA':
                        case 'ArrowLeft':
                            this.keys.left = false;
                            break;
                        case 'KeyD':
                        case 'ArrowRight':
                            this.keys.right = false;
                            break;
                    }
                });
            }
            
            duck(isDucking) {
                this.isDucking = isDucking;
                if (isDucking) {
                    this.height = 35;
                    this.element.style.height = this.height + 'px';
                    this.element.style.transform = 'scaleY(0.6)';
                } else {
                    this.height = 60;
                    this.element.style.height = this.height + 'px';
                    this.element.style.transform = 'scaleY(1)';
                }
            }
            
            update(deltaTime) {
                // Horizontal movement
                this.velocityX = 0;
                if (this.keys.left) this.velocityX = -this.speed;
                if (this.keys.right) this.velocityX = this.speed;
                
                // Apply gravity
                if (!this.isOnGround) {
                    this.velocityY += this.gravity * deltaTime;
                }
                
                // Update position
                this.x += this.velocityX * deltaTime;
                this.y += this.velocityY * deltaTime;
                
                // Ground collision
                if (this.y >= this.groundY) {
                    this.y = this.groundY;
                    this.velocityY = 0;
                    this.isOnGround = true;
                }
                
                // Keep in bounds
                const maxX = window.innerWidth - this.width;
                this.x = Math.max(0, Math.min(maxX, this.x));
                
                // Check obstacle collisions
                this.checkObstacleCollisions();
                
                this.updatePosition();
            }
            
            checkObstacleCollisions() {
                obstacles.forEach(obstacle => {
                    if (this.x < obstacle.x + obstacle.width &&
                        this.x + this.width > obstacle.x &&
                        this.y < obstacle.y + obstacle.height &&
                        this.y + this.height > obstacle.y) {
                        
                        // Push player back
                        if (this.x < obstacle.x) {
                            this.x = obstacle.x - this.width - 2;
                        } else {
                            this.x = obstacle.x + obstacle.width + 2;
                        }
                    }
                });
            }
            
            updatePosition() {
                if (this.element) {
                    this.element.style.left = this.x + 'px';
                    this.element.style.top = this.y + 'px';
                }
            }
            
            destroy() {
                if (this.element && this.element.parentNode) {
                    this.element.parentNode.removeChild(this.element);
                }
            }
        }
        
        // Initialize the game
        function initGame() {
            console.log('Initializing BWS Game...');
            
            // Create event manager
            const eventManager = new EventManager();
            
            // Create and initialize menu
            const menu = new Menu();
            menu.init();
            
            console.log('Game initialization complete');
        }
        
        // Game functions
        function startTutorial() {
            console.log('Starting tutorial...');
            gameState = 'playing';
            
            // Hide menu if exists
            const menuEl = document.getElementById('startScreen');
            if (menuEl) menuEl.style.display = 'none';
            
            // Create game environment
            createGameEnvironment();
            
            // Create player
            player = new SimplePlayer();
            
            // Create obstacles
            createObstacles();
            
            // Start game loop
            startGameLoop();
        }
        
        function createGameEnvironment() {
            // Create environment container
            const environment = document.createElement('div');
            environment.id = 'gameEnvironment';
            environment.style.position = 'fixed';
            environment.style.top = '0';
            environment.style.left = '0';
            environment.style.width = '100%';
            environment.style.height = '100%';
            environment.style.background = 'linear-gradient(to bottom, #1a1a2e 0%, #16213e 50%, #8b4513 100%)';
            environment.style.zIndex = '1';
            
            // Add trees
            createTrees(environment);
            
            // Add moon
            createMoon(environment);
            
            // Add ground
            createGround(environment);
            
            // Add controls overlay
            createControlsOverlay(environment);
            
            document.getElementById('gameContainer').appendChild(environment);
        }
        
        function createTrees(container) {
            for (let i = 0; i < 8; i++) {
                const tree = document.createElement('div');
                tree.style.position = 'absolute';
                tree.style.bottom = '150px';
                tree.style.left = (i * 180 + Math.random() * 60) + 'px';
                tree.style.width = '0';
                tree.style.height = '0';
                tree.style.borderLeft = '30px solid transparent';
                tree.style.borderRight = '30px solid transparent';
                tree.style.borderBottom = '100px solid #2d5016';
                tree.style.zIndex = '2';
                
                // Tree trunk
                const trunk = document.createElement('div');
                trunk.style.position = 'absolute';
                trunk.style.bottom = '-25px';
                trunk.style.left = '20px';
                trunk.style.width = '20px';
                trunk.style.height = '30px';
                trunk.style.background = 'repeating-linear-gradient(0deg, #8b4513 0px, #a0522d 4px, #654321 8px)';
                
                tree.appendChild(trunk);
                container.appendChild(tree);
            }
        }
        
        function createMoon(container) {
            const moon = document.createElement('div');
            moon.style.position = 'absolute';
            moon.style.top = '80px';
            moon.style.right = '150px';
            moon.style.width = '80px';
            moon.style.height = '80px';
            moon.style.background = '#ffff00';
            moon.style.borderRadius = '50%';
            moon.style.boxShadow = '0 0 30px rgba(255, 255, 0, 0.5)';
            moon.style.zIndex = '2';
            
            container.appendChild(moon);
        }
        
        function createGround(container) {
            const ground = document.createElement('div');
            ground.style.position = 'absolute';
            ground.style.bottom = '0';
            ground.style.left = '0';
            ground.style.width = '100%';
            ground.style.height = '150px';
            ground.style.background = 'repeating-linear-gradient(90deg, #8b4513 0px, #a0522d 25px, #654321 50px)';
            ground.style.zIndex = '2';
            
            container.appendChild(ground);
        }
        
        function createControlsOverlay(container) {
            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.top = '20px';
            overlay.style.left = '20px';
            overlay.style.background = 'rgba(0, 0, 0, 0.8)';
            overlay.style.color = '#fff';
            overlay.style.padding = '20px';
            overlay.style.borderRadius = '10px';
            overlay.style.fontSize = '18px';
            overlay.style.lineHeight = '1.5';
            overlay.style.zIndex = '100';
            overlay.style.maxWidth = '300px';
            
            overlay.innerHTML = `
                <div style="font-size: 22px; font-weight: bold; margin-bottom: 15px; color: #ffff99;">
                    🎮 Tutorial - Controls
                </div>
                <div style="margin-bottom: 10px;"><strong>W</strong> or <strong>↑</strong> - Jump</div>
                <div style="margin-bottom: 10px;"><strong>S</strong> or <strong>↓</strong> - Duck</div>
                <div style="margin-bottom: 10px;"><strong>A</strong> or <strong>←</strong> - Move Left</div>
                <div style="margin-bottom: 15px;"><strong>D</strong> or <strong>→</strong> - Move Right</div>
                <div style="font-size: 16px; color: #ffff99;">💡 Jump over the tree log!</div>
                <button onclick="backToMenu()" style="margin-top: 15px; padding: 8px 16px; background: rgba(255,255,255,0.1); border: 2px solid #fff; color: #fff; cursor: pointer; border-radius: 5px;">Back to Menu</button>
            `;
            
            container.appendChild(overlay);
        }
        
        function createObstacles() {
            // Create tree log obstacle like in screenshot
            const logObstacle = {
                x: 400,
                y: 320,
                width: 150,
                height: 80
            };
            
            const logElement = document.createElement('div');
            logElement.style.position = 'absolute';
            logElement.style.left = logObstacle.x + 'px';
            logElement.style.top = logObstacle.y + 'px';
            logElement.style.width = logObstacle.width + 'px';
            logElement.style.height = logObstacle.height + 'px';
            logElement.style.background = 'repeating-linear-gradient(0deg, #8b4513 0px, #a0522d 12px, #654321 24px)';
            logElement.style.borderRadius = '40px';
            logElement.style.border = '4px solid #654321';
            logElement.style.zIndex = '5';
            logElement.style.boxShadow = 'inset 0 0 15px rgba(0,0,0,0.4)';
            
            // Add log rings
            const ring1 = document.createElement('div');
            ring1.style.position = 'absolute';
            ring1.style.right = '15px';
            ring1.style.top = '50%';
            ring1.style.transform = 'translateY(-50%)';
            ring1.style.width = '50px';
            ring1.style.height = '50px';
            ring1.style.border = '4px solid #654321';
            ring1.style.borderRadius = '50%';
            ring1.style.background = '#a0522d';
            
            const ring2 = document.createElement('div');
            ring2.style.position = 'absolute';
            ring2.style.left = '15px';
            ring2.style.top = '50%';
            ring2.style.transform = 'translateY(-50%)';
            ring2.style.width = '45px';
            ring2.style.height = '45px';
            ring2.style.border = '3px solid #654321';
            ring2.style.borderRadius = '50%';
            ring2.style.background = '#8b4513';
            
            logElement.appendChild(ring1);
            logElement.appendChild(ring2);
            
            obstacles.push(logObstacle);
            document.getElementById('gameContainer').appendChild(logElement);
        }
        
        function startGameLoop() {
            let lastTime = 0;
            
            function loop() {
                if (gameState !== 'playing') return;
                
                const currentTime = performance.now();
                const deltaTime = (currentTime - lastTime) / 1000;
                lastTime = currentTime;
                
                if (player) {
                    player.update(deltaTime);
                    
                    // Check if player reached end
                    if (player.x > window.innerWidth - 100) {
                        console.log('Tutorial completed!');
                        // Could trigger level complete here
                    }
                }
                
                requestAnimationFrame(loop);
            }
            
            lastTime = performance.now();
            loop();
        }
        
        function backToMenu() {
            console.log('Returning to menu...');
            gameState = 'menu';
            
            // Clean up game elements
            if (player) {
                player.destroy();
                player = null;
            }
            
            const gameEnv = document.getElementById('gameEnvironment');
            if (gameEnv) gameEnv.remove();
            
            // Remove obstacles
            obstacles = [];
            document.querySelectorAll('.game-player').forEach(el => el.remove());
            
            // Show menu
            const menuEl = document.getElementById('startScreen');
            if (menuEl) {
                menuEl.style.display = 'flex';
            } else {
                // Recreate menu if needed
                location.reload();
            }
        }
        
        // Override the window startGame event to use our tutorial
        window.addEventListener('startGame', () => {
            startTutorial();
        });
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
        });
        
        console.log('BWS Game script loaded');
    </script>
</body>
</html> 